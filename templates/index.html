<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TranscribeFlow - AI Audio Transcription</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@600;800&family=Playfair+Display:ital,wght@1,900&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">

<<<<<<< HEAD
=======
        /* ROBOT MASCOT & SPEECH BUBBLE */
        .bot-container {
            position: fixed; bottom: 40px; right: 40px; width: 140px; height: 140px;
            z-index: 100; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.6));
            animation: floatBot 4s ease-in-out infinite; cursor: pointer;
        }
        @keyframes floatBot { 0% { transform: translateY(0); } 50% { transform: translateY(-15px); } 100% { transform: translateY(0); } }
        
        
        .bot-body { width: 100%; height: 100%; background: radial-gradient(circle at 30% 30%, #ffffff, #e0e0e0, #a0a0a0); border-radius: 50%; position: relative; box-shadow: inset -10px -10px 20px rgba(0,0,0,0.5); }
        .bot-body::before { content: ''; position: absolute; left: -8px; top: 50%; transform: translateY(-50%); width: 15px; height: 30px; background: #c0c0c0; border-radius: 10px 0 0 10px; box-shadow: inset -2px 0 5px rgba(0,0,0,0.3); }
        .bot-screen { position: absolute; top: 22%; left: 15%; width: 75%; height: 55%; background: black; border-radius: 40% 40% 45% 45%; box-shadow: inset 0 0 15px #00ffff; overflow: hidden; display: flex; justify-content: center; align-items: center; gap: 18px; }
        .bot-eye { width: 14px; height: 30px; background: linear-gradient(180deg, #00ffff, #0088ff); border-radius: 20px; box-shadow: 0 0 15px #00ffff; position: relative; }
        .bot-eye.star-mode { width: 28px; height: 28px; border-radius: 0; background: #ffd700; box-shadow: 0 0 20px #ffff00, 0 0 40px #ffd700; clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%); transform: rotate(180deg) !important; transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
        .bot-shine { position: absolute; top: 15%; right: 20%; width: 20px; height: 10px; background: rgba(255,255,255,0.8); border-radius: 50%; transform: rotate(-45deg); }

        /* Speech Bubble Styling */
        .bot-bubble {
            position: absolute;
            bottom: 160px; /* Above the bot */
            right: 20px;
            width: 220px;
            background: rgba(20, 20, 20, 0.9);
            border: 1px solid #00ffff;
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 20px 20px 0 20px;
            color: #fff;
            font-size: 13px;
            font-weight: 600;
            line-height: 1.5;
            text-align: right;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.2);
            opacity: 0;
            transform: translateY(10px) scale(0.9);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: none;
        }
        .bot-bubble.show {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
        .bot-bubble::after {
            content: ''; position: absolute; bottom: -8px; right: 0;
            width: 0; height: 0;
            border-left: 10px solid transparent;
            border-top: 10px solid #00ffff;
        }

        /* Speech Bubble Styling */
        .bot-bubble {
            position: absolute;
            bottom: 160px; /* Above the bot */
            right: 20px;
            width: 220px;
            background: rgba(20, 20, 20, 0.9);
            border: 1px solid #00ffff;
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 20px 20px 0 20px;
            color: #fff;
            font-size: 13px;
            font-weight: 600;
            line-height: 1.5;
            text-align: right;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.2);
            opacity: 0;
            transform: translateY(10px) scale(0.9);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: none;
        }
        .bot-bubble.show {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
        .bot-bubble::after {
            content: ''; position: absolute; bottom: -8px; right: 0;
            width: 0; height: 0;
            border-left: 10px solid transparent;
            border-top: 10px solid #00ffff;
        }

        /* ========================================================
           AUTH MODAL
           AUTH MODAL
        ======================================================== */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(10px);
            z-index: 1000; display: none; align-items: center; justify-content: center;
            opacity: 0; transition: opacity 0.3s ease;
        }
        .auth-card {
            background: rgba(20, 20, 20, 0.95); border: 1px solid #00ffff;
            padding: 40px; border-radius: 30px; width: 100%; max-width: 420px;
            box-shadow: 0 0 50px rgba(0, 255, 255, 0.2); text-align: center;
            transform: scale(0.9); transition: transform 0.3s ease;
            max-height: 90vh; overflow-y: auto;
        }
        .auth-card::-webkit-scrollbar { width: 4px; }
        .auth-card::-webkit-scrollbar-thumb { background: #00ffff; border-radius: 10px; }

        .auth-input {
            width: 100%; padding: 14px 16px; margin-bottom: 12px;
            background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px; color: white; outline: none; box-sizing: border-box;
            font-family: 'Plus Jakarta Sans', sans-serif; font-size: 14px;
            transition: border-color 0.25s;
        }
        .auth-input:focus { border-color: #00ffff; background: rgba(0,255,255,0.04); }
        .auth-input::placeholder { color: rgba(255,255,255,0.35); }

        .login-type-toggle { display: flex; gap: 8px; margin-bottom: 16px; }
        .login-type-toggle { display: flex; gap: 8px; margin-bottom: 16px; }
        .toggle-pill {
            flex: 1; padding: 9px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.15);
            background: transparent; color: rgba(255,255,255,0.5); font-weight: 700;
            font-size: 12px; cursor: pointer; letter-spacing: 0.5px; transition: 0.25s;
        }
        .toggle-pill.active { background: #00ffff; color: #000; border-color: #00ffff; }
        .toggle-pill.active { background: #00ffff; color: #000; border-color: #00ffff; }

        .pwd-meter-wrap { text-align: left; margin-bottom: 12px; }
        .pwd-meter-bar { height: 4px; border-radius: 10px; background: rgba(255,255,255,0.1); overflow: hidden; margin-bottom: 5px; }
        .pwd-meter-fill { height: 100%; width: 0%; border-radius: 10px; transition: width 0.3s, background 0.3s; }
        .pwd-meter-text { font-size: 11px; font-weight: 700; letter-spacing: 0.5px; color: rgba(255,255,255,0.4); transition: color 0.3s; }
        .pwd-rules { margin: 0 0 12px; padding: 0; list-style: none; text-align: left; }
        .pwd-rules li { font-size: 11px; padding: 3px 0; color: rgba(255,255,255,0.4); transition: color 0.3s; display: flex; align-items: center; gap: 6px; }
        .pwd-rules li::before { content: '‚úó'; font-weight: 800; color: #ff4444; transition: 0.3s; }
        .pwd-rules li.ok { color: #00ffcc; }
        .pwd-rules li.ok::before { content: '‚úì'; color: #00ffcc; }

        .auth-btn {
            width: 100%; padding: 15px; background: #00ffff; color: #000;
            border: none; border-radius: 12px; font-weight: 800; cursor: pointer;
            margin-top: 4px; transition: 0.3s; font-family: 'Plus Jakarta Sans', sans-serif;
            font-size: 14px; letter-spacing: 0.5px;
        }
        .auth-btn:hover { transform: scale(1.02); box-shadow: 0 0 20px rgba(0, 255, 255, 0.4); }
        .auth-btn:disabled { background: #555; color: #888; cursor: not-allowed; transform: none; }

        .auth-divider { display: flex; align-items: center; gap: 10px; margin: 14px 0; }
        .auth-divider::before, .auth-divider::after { content: ''; flex: 1; height: 1px; background: rgba(255,255,255,0.1); }
        .auth-divider span { font-size: 11px; color: rgba(255,255,255,0.3); font-weight: 700; letter-spacing: 1px; }

        .toggle-text { margin-top: 16px; font-size: 13px; color: #aaa; cursor: pointer; }
        .toggle-text span { color: #00ffff; font-weight: 800; text-decoration: underline; }
        .forgot-link { display: block; margin-top: 10px; font-size: 12px; color: rgba(0,255,255,0.7); cursor: pointer; transition: color 0.2s; }
        .forgot-link:hover { color: #00ffff; }
        .auth-error { color: #ff4444; font-size: 12px; font-weight: 700; margin-top: 8px; min-height: 16px; }
        .auth-success { color: #00ffcc; font-size: 13px; font-weight: 700; margin-top: 8px; min-height: 16px; line-height: 1.5; }

        /* ========================================================
           HOW IT WORKS SECTION (NO LINES)
        ======================================================== */
        .how-it-works-section {
            width: 100%; max-width: 1200px; padding: 0 20px; margin-bottom: 60px;
            opacity: 0; animation: fadeIn 1s ease-out 0.5s forwards; position: relative; z-index: 2; box-sizing: border-box;
        }
        .section-header { text-align: center; margin-bottom: 70px; }
        .section-title {
            font-family: 'Playfair Display', serif; font-size: 28px; font-style: italic; font-weight: 900;
            color: #fff; text-shadow: 0 0 20px rgba(0,255,255,0.5); position: relative; padding-bottom: 15px;
        }
        
        .steps-container { 
            display: flex; justify-content: space-between; gap: 30px; position: relative; flex-wrap: wrap; 
        }
        
        .step-card {
            flex: 1; min-width: 220px;
            background: linear-gradient(145deg, rgba(20,20,20,0.9), rgba(10,10,10,0.95));
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px); border-radius: 24px; padding: 40px 25px;
            text-align: center; position: relative; 
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        .step-card:hover {
            transform: translateY(-12px); 
            border-color: rgba(0, 255, 255, 0.4);
            box-shadow: 0 20px 50px rgba(0, 255, 255, 0.15), inset 0 0 30px rgba(0,255,255,0.05);
        }

        /* Giant Watermark Number */
        .step-watermark {
            position: absolute; top: -10px; right: -10px;
            font-family: 'Plus Jakarta Sans', sans-serif; font-weight: 900; font-size: 80px;
            color: rgba(255,255,255,0.02); line-height: 1; pointer-events: none;
            transition: 0.4s;
        }
        .step-card:hover .step-watermark {
            color: rgba(0, 255, 255, 0.08); transform: scale(1.1);
        }

        /* Icon Styling */
        .icon-box {
            width: 80px; height: 80px; margin: 0 auto 25px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 50%; background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1); position: relative; z-index: 2;
            transition: 0.4s;
        }
        .step-card:hover .icon-box {
            background: rgba(0, 255, 255, 0.1); border-color: #00ffff;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.4);
        }
        
        .step-icon { width: 40px; height: 40px; fill: rgba(255,255,255,0.7); transition: 0.4s; }
        .step-card:hover .step-icon { fill: #00ffff; transform: scale(1.1) rotate(5deg); filter: drop-shadow(0 0 8px #00ffff); }

        .step-title { 
            font-size: 18px; font-weight: 800; color: #fff; margin-bottom: 12px; letter-spacing: 0.5px; position: relative; z-index: 2;
        }
        .step-desc { 
            font-size: 14px; color: rgba(255, 255, 255, 0.5); line-height: 1.6; position: relative; z-index: 2;
        }
        
        /* Bottom Glow Bar */
        .step-card::after {
            content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 3px;
            background: #00ffff; transform: scaleX(0); transform-origin: left;
            transition: transform 0.4s ease; box-shadow: 0 -5px 15px #00ffff;
        }
        .step-card:hover::after { transform: scaleX(1); }

        @media (max-width: 900px) {
            .steps-container { flex-direction: column; gap: 40px; }
            .section-title { font-size: 24px; }
        }

        /* ========================================================
           LANDING & APP
           HOW IT WORKS SECTION (NO LINES)
        ======================================================== */
        .how-it-works-section {
            width: 100%; max-width: 1200px; padding: 0 20px; margin-bottom: 60px;
            opacity: 0; animation: fadeIn 1s ease-out 0.5s forwards; position: relative; z-index: 2; box-sizing: border-box;
        }
        .section-header { text-align: center; margin-bottom: 70px; }
        .section-title {
            font-family: 'Playfair Display', serif; font-size: 28px; font-style: italic; font-weight: 900;
            color: #fff; text-shadow: 0 0 20px rgba(0,255,255,0.5); position: relative; padding-bottom: 15px;
        }
        
        .steps-container { 
            display: flex; justify-content: space-between; gap: 30px; position: relative; flex-wrap: wrap; 
        }
        
        .step-card {
            flex: 1; min-width: 220px;
            background: linear-gradient(145deg, rgba(20,20,20,0.9), rgba(10,10,10,0.95));
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px); border-radius: 24px; padding: 40px 25px;
            text-align: center; position: relative; 
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        .step-card:hover {
            transform: translateY(-12px); 
            border-color: rgba(0, 255, 255, 0.4);
            box-shadow: 0 20px 50px rgba(0, 255, 255, 0.15), inset 0 0 30px rgba(0,255,255,0.05);
        }

        /* Giant Watermark Number */
        .step-watermark {
            position: absolute; top: -10px; right: -10px;
            font-family: 'Plus Jakarta Sans', sans-serif; font-weight: 900; font-size: 80px;
            color: rgba(255,255,255,0.02); line-height: 1; pointer-events: none;
            transition: 0.4s;
        }
        .step-card:hover .step-watermark {
            color: rgba(0, 255, 255, 0.08); transform: scale(1.1);
        }

        /* Icon Styling */
        .icon-box {
            width: 80px; height: 80px; margin: 0 auto 25px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 50%; background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1); position: relative; z-index: 2;
            transition: 0.4s;
        }
        .step-card:hover .icon-box {
            background: rgba(0, 255, 255, 0.1); border-color: #00ffff;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.4);
        }
        
        .step-icon { width: 40px; height: 40px; fill: rgba(255,255,255,0.7); transition: 0.4s; }
        .step-card:hover .step-icon { fill: #00ffff; transform: scale(1.1) rotate(5deg); filter: drop-shadow(0 0 8px #00ffff); }

        .step-title { 
            font-size: 18px; font-weight: 800; color: #fff; margin-bottom: 12px; letter-spacing: 0.5px; position: relative; z-index: 2;
        }
        .step-desc { 
            font-size: 14px; color: rgba(255, 255, 255, 0.5); line-height: 1.6; position: relative; z-index: 2;
        }
        
        /* Bottom Glow Bar */
        .step-card::after {
            content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 3px;
            background: #00ffff; transform: scaleX(0); transform-origin: left;
            transition: transform 0.4s ease; box-shadow: 0 -5px 15px #00ffff;
        }
        .step-card:hover::after { transform: scaleX(1); }

        @media (max-width: 900px) {
            .steps-container { flex-direction: column; gap: 40px; }
            .section-title { font-size: 24px; }
        }

        /* ========================================================
           LANDING & APP
        ======================================================== */
        #landing-view {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            min-height: 100vh; width: 100%; text-align: center; z-index: 5;
            padding-top: 100px; padding-bottom: 50px;
            transition: opacity 0.8s ease, transform 0.8s ease; box-sizing: border-box;
            min-height: 100vh; width: 100%; text-align: center; z-index: 5;
            padding-top: 100px; padding-bottom: 50px;
            transition: opacity 0.8s ease, transform 0.8s ease; box-sizing: border-box;
        }
        .landing-title { font-size: clamp(48px, 8vw, 90px); font-weight: 800; letter-spacing: -4px; line-height: 0.9; margin-bottom: 30px; background: linear-gradient(to bottom, #fff, #666); background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .start-btn { background: #fff; color: #000; border: none; padding: 22px 50px; font-size: 18px; font-weight: 800; border-radius: 100px; cursor: pointer; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); box-shadow: 0 10px 30px rgba(255,255,255,0.1); margin-top: 20px; }
        .start-btn { background: #fff; color: #000; border: none; padding: 22px 50px; font-size: 18px; font-weight: 800; border-radius: 100px; cursor: pointer; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); box-shadow: 0 10px 30px rgba(255,255,255,0.1); margin-top: 20px; }
        .start-btn:hover { transform: scale(1.05); background: #00ffff; box-shadow: 0 0 30px rgba(0, 255, 255, 0.5); }

        #app-view { display: none; flex-direction: column; align-items: center; width: 100%; padding: 120px 20px 80px 20px; opacity: 0; transform: translateY(30px); transition: opacity 1s ease, transform 1s ease; box-sizing: border-box; }
        #app-view { display: none; flex-direction: column; align-items: center; width: 100%; padding: 120px 20px 80px 20px; opacity: 0; transform: translateY(30px); transition: opacity 1s ease, transform 1s ease; box-sizing: border-box; }
        .hero-section { text-align: center; margin-bottom: 50px; }
        .hero-headline { font-size: clamp(32px, 5vw, 64px); font-weight: 800; line-height: 1.1; margin-bottom: 20px; background: linear-gradient(135deg, #ffffff 0%, #a5a5a5 100%); background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent; letter-spacing: -2px; }
        
        .upload-card { position: relative; width: 100%; max-width: 520px; background: rgba(255, 255, 255, 0.04); backdrop-filter: blur(25px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 35px; padding: 40px; box-shadow: 0 30px 60px rgba(0,0,0,0.6); z-index: 2; box-sizing: border-box; }
        .upload-card { position: relative; width: 100%; max-width: 520px; background: rgba(255, 255, 255, 0.04); backdrop-filter: blur(25px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 35px; padding: 40px; box-shadow: 0 30px 60px rgba(0,0,0,0.6); z-index: 2; box-sizing: border-box; }
        .result-panel { width: 100%; max-width: 800px; background: rgba(255, 255, 255, 0.02); backdrop-filter: blur(40px); border: 1px solid rgba(0, 255, 255, 0.2); border-radius: 35px; padding: 40px; margin-top: 30px; margin-bottom: 50px; animation: fadeIn 0.8s ease-out; box-sizing: border-box; }
        .result-label { font-size: 11px; font-weight: 800; letter-spacing: 2px; color: #00ffff; text-transform: uppercase; margin-bottom: 15px; display: block; opacity: 0.8; }
        .transcript-box { background: rgba(255, 255, 255, 0.03); padding: 30px; border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.08); color: #f0f0f0; line-height: 2.2; margin-bottom: 30px; font-size: 15px; font-family: 'Plus Jakarta Sans', sans-serif; max-height: 450px; overflow-y: auto; white-space: pre-wrap; scrollbar-width: thin; scrollbar-color: #00ffff rgba(255, 255, 255, 0.1); scroll-behavior: smooth; }
        .timestamp { color: #000 !important; font-weight: 800; background: #00ffff; padding: 2px 10px; border-radius: 6px; display: inline-block; margin-right: 8px; font-size: 12px; letter-spacing: 0.5px; box-shadow: 0 0 15px rgba(0, 255, 255, 0.3); vertical-align: middle; line-height: 1; }
        .transcript-box::-webkit-scrollbar { width: 6px; }
        .transcript-box::-webkit-scrollbar-thumb { background-color: #00ffff; border-radius: 100px; }
        .summary-box { background: rgba(0, 255, 255, 0.05); padding: 30px; border-radius: 20px; border: 1px solid rgba(0, 255, 255, 0.2); color: #00ffff; font-style: italic; line-height: 1.6; font-size: 18px; margin-bottom: 30px; }
        .report-controls { display: flex; gap: 10px; margin-bottom: 25px; align-items: center; background: rgba(255,255,255,0.03); padding: 15px; border-radius: 20px; }
        .lang-select { flex: 1; background: rgba(0,0,0,0.3); border: 1px solid rgba(0, 255, 255, 0.2); border-radius: 12px; padding: 10px; color: white; font-weight: 600; outline: none; }
        .translate-action-btn { background: #00ffff; color: #000; border: none; padding: 10px 20px; border-radius: 12px; font-weight: 800; cursor: pointer; transition: 0.3s; }
        .translate-action-btn:hover { background: #00ff88; transform: scale(1.02); }
        .download-actions { display: flex; gap: 15px; justify-content: center; margin-top: 10px; border-top: 1px solid rgba(255, 255, 255, 0.1); padding-top: 25px; }
        .download-btn { background: rgba(255, 255, 255, 0.05); color: #00ffff; border: 1px solid rgba(0, 255, 255, 0.2); padding: 12px 25px; border-radius: 15px; font-size: 13px; font-weight: 800; text-decoration: none; transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); display: flex; align-items: center; gap: 8px; }
        .download-btn:hover { background: rgba(0, 255, 255, 0.1); border-color: #00ffff; transform: translateY(-3px); }
        .drop-zone { position: relative; padding: 40px 20px; border: 2px dashed rgba(255, 255, 255, 0.15); border-radius: 30px; display: flex; flex-direction: column; align-items: center; cursor: pointer; transition: 0.4s; background: rgba(255, 255, 255, 0.01); }
        .upload-pod { width: 80px; height: 80px; background: rgba(255, 255, 255, 0.05); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; border: 1px solid rgba(0, 255, 255, 0.2); }
        .pulse-ring { position: absolute; width: 100%; height: 100%; border-radius: 50%; border: 2px solid #00ffff; animation: ripple 2s infinite; opacity: 0; }
        #icon { font-size: 35px; filter: drop-shadow(0 0 10px #00ffff); transition: 0.3s; }
        @keyframes ripple { 0% { transform: scale(0.8); opacity: 0.8; } 100% { transform: scale(1.6); opacity: 0; } }
        .submit-btn { width: 100%; background: #fff; color: #000; border: none; padding: 18px; font-size: 16px; font-weight: 800; border-radius: 50px; cursor: pointer; margin-top: 20px; transition: 0.3s; }
        .submit-btn:hover { background: #00ffff; box-shadow: 0 0 20px rgba(0, 255, 255, 0.4); }
        .submit-btn:disabled { background: #333; color: #666; cursor: not-allowed; }
        #preview-container { display: none; margin-top: 25px; width: 100%; text-align: center; }
        #preview-container p { font-size: 11px; color: #00ffff; margin-bottom: 10px; font-weight: 800; letter-spacing: 1.5px; }
        .preview-audio-player { width: 100%; height: 40px; border-radius: 12px; filter: invert(100%) hue-rotate(180deg) brightness(1.5); }
        .file-list-container { width: 100%; max-width: 800px; padding-bottom: 50px; }
        .file-item { background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px; padding: 20px; margin-bottom: 15px; display: flex; flex-direction: column; gap: 15px; }
        .error-message { color: #ff3c3c; font-size: 12px; font-weight: 800; margin-top: 10px; display: none; text-align: center; }
        .progress-container { width: 100%; max-width: 800px; margin-top: 30px; padding: 35px; background: rgba(0, 255, 255, 0.05); border: 1px solid rgba(0, 255, 255, 0.2); border-radius: 30px; display: none; backdrop-filter: blur(10px); }
        .progress-bar { width: 100%; height: 10px; background: rgba(0, 255, 255, 0.1); border-radius: 20px; overflow: hidden; margin-bottom: 20px; border: 1px solid rgba(0, 255, 255, 0.1); }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #00ffff, #00ff88, #00ffff); background-size: 200% 100%; animation: shimmer 2s linear infinite; width: 0%; transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1); border-radius: 20px; }
        .progress-message { text-align: center; color: #fff; font-size: 15px; font-weight: 600; min-height: 22px; transition: 0.3s; letter-spacing: 0.5px; }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        .success-toast { position: fixed; top: 40px; left: 50%; transform: translateX(-50%); background: #00ffff; color: #000; padding: 16px 35px; border-radius: 100px; font-weight: 800; font-size: 14px; box-shadow: 0 10px 50px rgba(0,0,0,0.8); z-index: 99999; opacity: 0; transition: 0.5s; pointer-events: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        audio:not(.preview-audio-player) { width: 100%; height: 35px; filter: invert(100%) hue-rotate(180deg) brightness(1.5); }

        /* --- NEW CSS FOR SORTING FILTER --- */
        .filter-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 800px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-top: 40px;
        }
        .sort-select {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(0, 255, 255, 0.3);
            color: #00ffff;
            padding: 8px 12px;
            border-radius: 8px;
            outline: none;
            font-family: 'Plus Jakarta Sans', sans-serif;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
        }
        .sort-select option {
            background: #1a1a1a;
            color: #fff;
            padding: 10px;
        }
        .file-meta {
            display: flex;
            gap: 10px;
            font-size: 10px;
            margin-top: 4px;
            opacity: 0.7;
        }
        .meta-tag {
            background: rgba(255,255,255,0.1);
            padding: 2px 6px;
            border-radius: 4px;
            color: #fff;
        }

        /* --- NEW CSS FOR SORTING FILTER --- */
        .filter-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 800px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-top: 40px;
        }
        .sort-select {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(0, 255, 255, 0.3);
            color: #00ffff;
            padding: 8px 12px;
            border-radius: 8px;
            outline: none;
            font-family: 'Plus Jakarta Sans', sans-serif;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
        }
        .sort-select option {
            background: #1a1a1a;
            color: #fff;
            padding: 10px;
        }
        .file-meta {
            display: flex;
            gap: 10px;
            font-size: 10px;
            margin-top: 4px;
            opacity: 0.7;
        }
        .meta-tag {
            background: rgba(255,255,255,0.1);
            padding: 2px 6px;
            border-radius: 4px;
            color: #fff;
        }
    </style>
>>>>>>> upstream/main
</head>

<body>
    <div id="vanta-bg"></div>
    <div id="toast-message" class="success-toast">UPLOAD SUCCESSFUL</div>

    <header class="nav-header">
        <div class="logo-text" onclick="window.location.reload()">TranscribeFlow</div>
        <div class="user-nav">
            <span id="user-greeting" class="user-greeting" style="display:none;"></span>
            <button id="login-btn" class="nav-btn btn-login" onclick="openAuth('login')">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                </svg>
                Login
            </button>
            <button id="signup-btn" class="nav-btn btn-signup" onclick="openAuth('register')">
                <svg viewBox="0 0 24 24">
                    <path d="M12 2l2.4 7.2h7.6l-6 4.8 2.4 7.2-6-4.8-6 4.8 2.4-7.2-6-4.8h7.6z" />
                </svg>
                Sign Up
            </button>
            <button id="logout-btn" class="nav-btn"
                style="display:none; border: 1px solid #ff3c3c; color:#ff3c3c; background: transparent;"
                onclick="logout()">Logout</button>
        </div>
    </header>

    <div class="bot-container" onclick="openAuthModal()" title="Click to login">
        <div class="bot-body">
            <div class="bot-shine"></div>
            <div class="bot-screen">
                <div class="bot-eye left-eye"></div>
                <div class="bot-eye right-eye"></div>
            </div>
        </div>
        <div id="bot-bubble" class="bot-bubble"></div>
        <div id="bot-bubble" class="bot-bubble"></div>
    </div>

    <div id="auth-modal" class="modal-overlay" onclick="handleModalBgClick(event)">
        <div class="auth-card" id="auth-card-inner">

            <div id="login-form">
                <h2 style="margin: 0 0 6px 0; font-family: 'Playfair Display', serif;">Welcome Back</h2>
                <p style="margin:0 0 20px; font-size:13px; color:rgba(255,255,255,0.4);">Sign in to your account</p>
<<<<<<< HEAD

=======
                <div class="login-type-toggle">
                    <button class="toggle-pill active" id="login-by-email-pill" onclick="setLoginType('email')">üìß Email</button>
                    <button class="toggle-pill" id="login-by-phone-pill" onclick="setLoginType('phone')">üì± Phone</button>
                </div>
>>>>>>> upstream/main
                <input type="text" id="login-identifier" class="auth-input" placeholder="Email address">
                <input type="password" id="login-password" class="auth-input" placeholder="Password">
                <div class="auth-error" id="login-error"></div>
                <button class="auth-btn" onclick="loginUser()">Log In</button>
                <a class="forgot-link" onclick="switchToForgot()">Forgot your password?</a>
                <div class="auth-divider"><span>OR</span></div>
                <div class="toggle-text">No account? <span onclick="toggleAuthMode('register')">Create one free</span>
                </div>
            </div>

            <div id="register-form" style="display:none;">
                <h2 style="margin: 0 0 6px 0; font-family: 'Playfair Display', serif;">Join TranscribeFlow</h2>
                <p style="margin:0 0 20px; font-size:13px; color:rgba(255,255,255,0.4);">Create your free account</p>
                <input type="text" id="reg-name" class="auth-input" placeholder="Full Name">
                <input type="email" id="reg-email" class="auth-input" placeholder="Email Address">
<<<<<<< HEAD
                <input type="password" id="reg-password" class="auth-input" placeholder="Create Password"
                    oninput="checkPasswordStrength(this.value)">

                <!-- Password strength meter -->
=======
                <input type="tel" id="reg-phone" class="auth-input" placeholder="Phone Number (optional)">
                <input type="password" id="reg-password" class="auth-input" placeholder="Create Password" oninput="checkPasswordStrength(this.value)">
>>>>>>> upstream/main
                <div class="pwd-meter-wrap">
                    <div class="pwd-meter-bar">
                        <div class="pwd-meter-fill" id="pwd-meter-fill"></div>
                    </div>
                    <div class="pwd-meter-text" id="pwd-meter-text">Enter a password</div>
                </div>
                <ul class="pwd-rules" id="pwd-rules">
                    <li id="rule-len">At least 8 characters</li>
                    <li id="rule-upper">One uppercase letter (A‚ÄìZ)</li>
                    <li id="rule-special">One special character (!@#$‚Ä¶)</li>
                </ul>
                <div class="auth-error" id="reg-error"></div>
                <button class="auth-btn" id="reg-btn" onclick="registerUser()">Create Account</button>
                <div class="auth-divider"><span>OR</span></div>
                <div class="toggle-text">Already have an account? <span onclick="toggleAuthMode('login')">Log In</span>
                </div>
            </div>

            <div id="forgot-form" style="display:none;">
                <h2 style="margin: 0 0 6px 0; font-family: 'Playfair Display', serif;">Reset Password</h2>
<<<<<<< HEAD
                <p style="margin:0 0 20px; font-size:13px; color:rgba(255,255,255,0.4);">Enter your registered email and
                    we'll send a reset link.</p>

=======
                <p style="margin:0 0 20px; font-size:13px; color:rgba(255,255,255,0.4);">Enter your registered email.</p>
>>>>>>> upstream/main
                <input type="email" id="forgot-email" class="auth-input" placeholder="Your Email Address">
                <div class="auth-error" id="forgot-error"></div>
                <div class="auth-success" id="forgot-success"></div>
<<<<<<< HEAD

                <button class="auth-btn" id="forgot-btn">Send Reset Link</button>
=======
                <button class="auth-btn" id="forgot-btn" onclick="sendForgotPassword()">Send Reset Link</button>
>>>>>>> upstream/main
                <div class="toggle-text" style="margin-top:16px;">
                    <span onclick="toggleAuthMode('login')">Back to Login</span>
                </div>
            </div>

            <button onclick="closeAuthModal()"
                style="background:none; border:none; color:#555; margin-top:18px; cursor:pointer; font-size:12px; letter-spacing:1px;">CLOSE</button>
        </div>
    </div>

    <section id="landing-view">
        <h1 class="landing-title">Audio to Insight<br>Instantly.</h1>
<<<<<<< HEAD
        <p style="opacity: 0.5; margin-bottom: 40px; max-width: 400px; line-height: 1.6;">Leverage professional-grade AI
            to transcribe and summarize your meetings, lectures, and voice notes.</p>
=======
        <p style="opacity: 0.5; margin-bottom: 50px; max-width: 400px; line-height: 1.6;">Leverage professional-grade AI to transcribe and summarize your meetings, lectures, and voice notes.</p>
        
        <div class="how-it-works-section">
            <div class="section-header">
                <span class="section-title">Workflow Protocol</span>
            </div>

            <div class="steps-container">
                <div class="step-card">
                    <div class="step-watermark">01</div>
                    <div class="icon-box">
                        <svg class="step-icon" viewBox="0 0 24 24">
                            <path d="M19.35,10.04C18.67,6.59,15.64,4,12,4C9.11,4,6.6,5.64,5.35,8.04C2.34,8.36,0,10.91,0,14c0,3.31,2.69,6,6,6h13 c2.76,0,5-2.24,5-5C24,12.36,21.95,10.22,19.35,10.04z M14,13v4h-4v-4H7l5-5l5,5H14z"/>
                            <circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="0.5" opacity="0.5"/>
                            <circle cx="19" cy="5" r="1.5" fill="#00ffff"/>
                            <circle cx="5" cy="19" r="1" fill="#00ffff"/>
                        </svg>
                    </div>
                    <div class="step-title">Secure Upload</div>
                    <p class="step-desc">Drag & drop encrypted audio files (MP3/WAV) directly into our secure cloud vault.</p>
                </div>

                <div class="step-card">
                    <div class="step-watermark">02</div>
                    <div class="icon-box">
                        <svg class="step-icon" viewBox="0 0 24 24">
                            <path d="M22,12c0-5.52-4.48-10-10-10S2,6.48,2,12s4.48,10,10,10S22,17.52,22,12z M12,20c-4.41,0-8-3.59-8-8s3.59-8,8-8s8,3.59,8,8 S16.41,20,12,20z"/>
                            <path d="M12,6c-3.31,0-6,2.69-6,6s2.69,6,6,6s6-2.69,6-6S15.31,6,12,6z M12,16c-2.21,0-4-1.79-4-4s1.79-4,4-4s4,1.79,4,4 S14.21,16,12,16z"/>
                            <rect x="11" y="2" width="2" height="4" fill="#00ffff"/>
                            <rect x="11" y="18" width="2" height="4" fill="#00ffff"/>
                            <rect x="2" y="11" width="4" height="2" fill="#00ffff"/>
                            <rect x="18" y="11" width="4" height="2" fill="#00ffff"/>
                        </svg>
                    </div>
                    <div class="step-title">Parameter Setup</div>
                    <p class="step-desc">Select from multiple available languages and enable advanced speaker identification algorithms.</p>
                </div>

                <div class="step-card">
                    <div class="step-watermark">03</div>
                    <div class="icon-box">
                        <svg class="step-icon" viewBox="0 0 24 24">
                             <path d="M12,2C6.48,2,2,6.48,2,12s4.48,10,10,10s10-4.48,10-10S17.52,2,12,2z M12,20c-4.41,0-8-3.59-8-8c0-4.41,3.59-8,8-8 s8,3.59,8,8C20,16.41,16.41,20,12,20z"/>
                             <circle cx="12" cy="12" r="3" fill="#00ffff"/>
                             <path d="M12,5v3 M12,16v3 M5,12h3 M16,12h3 M7.05,7.05l2.12,2.12 M14.83,14.83l2.12,2.12 M7.05,16.95l2.12-2.12 M14.83,9.17l2.12-2.12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <div class="step-title">Neural Processing</div>
                    <p class="step-desc">Our Whisper asr  engine and BART summarizer analyzes comlex audio  to extract text and actionable insights.</p>
                </div>

                <div class="step-card">
                    <div class="step-watermark">04</div>
                    <div class="icon-box">
                        <svg class="step-icon" viewBox="0 0 24 24">
                            <path d="M14,2H6C4.9,2,4,2.9,4,4v16c0,1.1,0.9,2,2,2h12c1.1,0,2-0.9,2-2V8L14,2z M16,18H8v-2h8V18z M16,14H8v-2h8V14z M13,9V3.5 L18.5,9H13z"/>
                            <polygon points="18,20 18,22 22,22 22,20" fill="#00ffff"/>
                            <polygon points="2,2 2,4 6,4 6,2" fill="#00ffff"/>
                        </svg>
                    </div>
                    <div class="step-title">Data Extraction</div>
                    <p class="step-desc">Receive your transcription in multiple formats (TXT/PDF) with auto-summaries attached.</p>
                </div>
            </div>
        </div>
>>>>>>> upstream/main
        <button class="start-btn" onclick="enterApp()">Start Transcribing</button>
    </section>

    <main id="app-view">
        <div class="hero-section">
            <h1 class="hero-headline">Full Audio Analysis</h1>
            <p style="opacity:0.6;">Transcribe, summarize, and archive with precision.</p>
        </div>

        <div class="upload-card">
            <form id="main-upload-form" enctype="multipart/form-data">
                <label for="audio-input" class="drop-zone" id="drop-zone">
                    <div class="upload-pod">
                        <div class="pulse-ring" id="pulse"></div>
                        <div id="icon">üéß</div>
                    </div>
                    <div id="text-wrap" style="text-align: center;">
                        <span style="font-weight: 800; font-size: 18px; display: block;">Select Audio Or Drag and Drop</span>
                        <span style="font-size: 12px; opacity: 0.5;">MP3, WAV, M4A, FLAC, AAC, OGG</span>
                    </div>
                    <span id="file-name-display"
                        style="margin-top: 10px; color: #00ffff; font-weight: 800; text-align: center;"></span>
                    <input type="file" name="audio" id="audio-input" style="display: none;" required>
                    <div id="format-error" class="error-message">Error: Invalid audio format.</div>
                </label>

                <div id="preview-container">
                    <p>LIVE PREVIEW</p>
                    <audio id="audio-live-preview" class="preview-audio-player" controls></audio>
                    <div id="waveform" style="margin-top:20px;"></div>
                </div>


                <button type="submit" id="submit-btn" class="submit-btn">Transcribe Now</button>
            </form>
        </div>

        <div id="progress-container" class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div class="progress-message" id="progress-message">Waking up the neural engine...</div>
            <div id="progress-percent"
                style="text-align:center; color:#00ff88; font-weight:800; margin-top:10px; font-size: 18px; letter-spacing: 1px;">
                0%</div>
        </div>

        <div id="dynamic-result-panel" class="result-panel" style="display: none;">
            <h2
                style="font-family: 'Playfair Display', serif; font-size: 32px; margin-bottom: 35px; text-align: center; background: linear-gradient(to right, #00ffff, #ffffff); background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                Intelligence Report</h2>

            <span class="result-label">Report Tools</span>
            <div class="report-controls">
                <input type="text" id="transcript-search" class="lang-select" placeholder="üîç Search keywords..."
                    oninput="searchTerm()">
                <button id="autoscroll-btn" class="translate-action-btn" onclick="toggleAutoScroll()"
                    style="background: rgba(255,255,255,0.1); color: white; border: 1px solid #00ffff; min-width: 140px;">Auto-Scroll:
                    OFF</button>
            </div>

            <span class="result-label">Translate Report</span>
            <div class="report-controls">
                <select id="report-lang-select" class="lang-select">
                    <option value="en">English (Original)</option>
                    <option value="hi">Hindi (‡§π‡§ø‡§®‡•ç‡§¶‡•Ä)</option>
                    <option value="es">Spanish (Espa√±ol)</option>
                    <option value="fr">French (Fran√ßais)</option>
                    <option value="de">German (Deutsch)</option>
                    <option value="zh-CN">Chinese (Simplified)</option>
                    <option value="ja">Japanese (Êó•Êú¨Ë™û)</option>
                    <option value="ar">Arabic (ÿßŸÑÿπÿ±ÿ®Ÿäÿ©)</option>
                </select>
                <button id="translate-btn" class="translate-action-btn" onclick="translateReport()">Update
                    Language</button>
            </div>

            <span class="result-label">Full Transcription</span>
            <div id="dynamic-transcript-box" class="transcript-box"></div>

            <span class="result-label">AI Summary</span>
            <div id="dynamic-summary-box" class="summary-box"></div>

            <div class="download-actions">
                <a id="current-download-txt" href="javascript:void(0)" class="download-btn"
                    onclick="downloadFile('txt')"><span>üìÑ</span>
                    Export TXT</a>
                <a id="current-download-docx" href="javascript:void(0)" class="download-btn"
                    onclick="downloadFile('docx')">
                    <span>üìù</span> Export DOCX
                </a>

            </div>
        </div>

<<<<<<< HEAD
        <div
            style="display: flex; justify-content: space-between; align-items: center; width: 100%; max-width: 800px; margin-top: 40px; margin-bottom: 20px;">
            <h2 style="margin: 0;">History</h2>
            {% if files %}
            <button onclick="confirmPurge()"
                style="background: rgba(255, 100, 0, 0.1); color: #ff8c00; border: 1px solid rgba(255, 140, 0, 0.3); padding: 10px 20px; border-radius: 15px; font-size: 12px; font-weight: 800; cursor: pointer;">PURGE
                ALL</button>
            {% endif %}
=======
        <div class="filter-bar">
            <h2 style="margin: 0;">History</h2>
            <div style="display: flex; gap: 10px; align-items: center;">
                <span style="font-size: 12px; opacity: 0.6;">Sort by:</span>
                <select id="sort-filter" class="sort-select" onchange="sortFiles()">
                    <option value="newest">üïí Newest Upload</option>
                    <option value="oldest">üïí Oldest Upload</option>
                    <option value="size-desc">üíæ Size (Largest)</option>
                    <option value="size-asc">üíæ Size (Smallest)</option>
                    <option value="type">üìÇ File Type</option>
                </select>
                {% if files %}
                <button onclick="confirmPurge()" style="background: rgba(255, 60, 60, 0.1); color: #ff3c3c; border: 1px solid rgba(255, 60, 60, 0.3); padding: 8px 15px; border-radius: 8px; font-size: 11px; font-weight: 800; cursor: pointer; margin-left: 10px;">PURGE ALL</button>
                {% endif %}
            </div>
>>>>>>> upstream/main
        </div>

        <div class="file-list-container" id="file-list-root">
        <div class="file-list-container" id="file-list-root">
            {% if files %}
<<<<<<< HEAD
            {% for file in files %}
            <div class="file-item" id="file-{{ loop.index }}">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <span style="font-weight: 600; display:block;">üìÑ {{ file.name }}</span>
                        <span style="font-size:10px; opacity:0.5;">{{ file.time }}</span>
=======
                {% for file in files %}
                    <div class="file-item" 
                         id="file-{{ loop.index }}" 
                         data-timestamp="{{ file.timestamp }}" 
                         data-size="{{ file.size }}" 
                         data-type="{{ file.type }}">
                         
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <div>
                                <span style="font-weight: 600; display:block;">üìÑ {{ file.name }}</span>
                                <div class="file-meta">
                                    <span class="meta-tag">{{ file.type }}</span>
                                    <span class="meta-tag">{{ file.size_str }}</span>
                                    <span>{{ file.time }}</span>
                                </div>
                            </div>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <a href="{{ url_for('download_file', filename=file.name, type='txt') }}" style="text-decoration: none; font-size: 12px; color: #00ffff; font-weight: 800;">TXT</a>
                                <a href="{{ url_for('download_file', filename=file.name, type='pdf') }}" style="text-decoration: none; font-size: 12px; color: #00ffff; font-weight: 800;">PDF</a>
                                <button onclick="confirmDelete('{{ file.name }}', 'file-{{ loop.index }}')" style="background:none; border:none; color:#ff3c3c; cursor:pointer; font-weight:800; font-size:12px;">DELETE</button>
                            </div>
                        </div>
                        <audio controls style="margin-top: 15px;">
                        <audio controls style="margin-top: 15px;">
                            <source src="{{ url_for('serve_audio', filename=file.name) }}" type="audio/mpeg">
                        </audio>
>>>>>>> upstream/main
                    </div>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <a href="javascript:void(0)" onclick="downloadHistoryFile('{{ file.name }}', 'txt')"
                            style="text-decoration: none; font-size: 12px; color: #00ffff; font-weight: 800;">TXT</a>
                        <a href="javascript:void(0)" onclick="downloadHistoryFile('{{ file.name }}', 'docx')"
                            style="text-decoration: none; font-size: 12px; color: #00ffff; font-weight: 800;">
                            DOCX
                        </a>

                        <button onclick="confirmDelete('{{ file.name }}', 'file-{{ loop.index }}')"
                            style="background:none; border:none; color:#ff3c3c; cursor:pointer; font-weight:800; font-size:12px;">DELETE</button>
                    </div>
                </div>
                <audio controls>
                    <source src="{{ url_for('transcription.serve_audio', filename=file.name) }}" type="audio/mpeg">
                </audio>
            </div>
            {% endfor %}
            {% else %}
            <p style="text-align: center; opacity: 0.4;">No history found.</p>
            {% endif %}
        </div>
    </main>
    <div class="modal-overlay" id="otp-modal" style="display:none;">
    <div class="auth-card">
        <h2 style="font-family:'Playfair Display', serif;">Verify OTP</h2>
        <p style="opacity:0.5;">Enter the 6-digit OTP sent to your email</p>

        <input type="text" id="otp-input" class="auth-input" placeholder="Enter OTP">
        <div id="otp-error" class="auth-error"></div>

        <button class="auth-btn" onclick="verifyOTP()">Verify</button>
        <button onclick="closeOtpModal()" style="margin-top:10px;background:none;border:none;color:#777;">Cancel</button>
    </div>
    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.waves.min.js"></script>
<<<<<<< HEAD
    <script src="https://unpkg.com/wavesurfer.js@7/dist/wavesurfer.min.js"></script>
    <script src="{{ url_for('static', filename='js/index.js') }}"></script>
=======

    <script>
        // ‚îÄ‚îÄ state ‚îÄ‚îÄ
        let masterTranscript = "";
        let masterSummary = "";
        let isAutoScroll = false;
        let currentDisplayTranscript = "";
        let currentFilename = "";
        let loginType = 'email'; // 'email' | 'phone'
        const botBubble = document.getElementById('bot-bubble');
        let botTimeout;
        const botBubble = document.getElementById('bot-bubble');
        let botTimeout;

        const loadingMessages = [
            "Waking up the AI models...",
            "Listening closely to every frequency...",
            "Whisper AI is translating thoughts to text...",
            "Filtering out background noise...",
            "Extracting core intelligence...",
            "Polishing the final transcript...",
            "Synthesizing your report...",
            "Finalizing the linguistic structure..."
        ];

        // ============================================================
        // BOT TRACKING & STAR EYE
        // ============================================================
        document.addEventListener('mousemove', (e) => {
            document.querySelectorAll('.bot-eye').forEach(eye => {
                if (eye.classList.contains('star-mode')) return;
                const rect = eye.getBoundingClientRect();
                const eyeX = rect.left + rect.width / 2;
                const eyeY = rect.top + rect.height / 2;
                const angle = Math.atan2(e.clientY - eyeY, e.clientX - eyeX);
                const distance = Math.min(8, Math.hypot(e.clientX - eyeX, e.clientY - eyeY));
                eye.style.transform = `translate(${Math.cos(angle)*distance}px, ${Math.sin(angle)*distance}px)`;
            });
        });

        document.addEventListener('DOMContentLoaded', () => {
            // Initial Welcome
            setTimeout(() => speak("Hi! I'm FlowBot. Upload an audio file to get started!"), 1000);

            // Initial Welcome
            setTimeout(() => speak("Hi! I'm FlowBot. Upload an audio file to get started!"), 1000);

            document.querySelectorAll('.start-btn, .submit-btn').forEach(btn => {
                btn.addEventListener('mouseenter', () => {
                    document.querySelectorAll('.bot-eye').forEach(e => { e.classList.add('star-mode'); e.style.transform='translate(0,0)'; });
                });
                btn.addEventListener('mouseleave', () => {
                    document.querySelectorAll('.bot-eye').forEach(e => e.classList.remove('star-mode'));
                });
            });
        });

        // ============================================================
        // BOT SPEECH FUNCTION
        // ============================================================
        function speak(text, duration=4000) {
            clearTimeout(botTimeout);
            botBubble.textContent = text;
            botBubble.classList.add('show');
            if(duration > 0) {
                botTimeout = setTimeout(() => botBubble.classList.remove('show'), duration);
            }
        }

        // ============================================================
        // BOT SPEECH FUNCTION
        // ============================================================
        function speak(text, duration=4000) {
            clearTimeout(botTimeout);
            botBubble.textContent = text;
            botBubble.classList.add('show');
            if(duration > 0) {
                botTimeout = setTimeout(() => botBubble.classList.remove('show'), duration);
            }
        }

        // ============================================================
        // MODAL HELPERS
        // ============================================================
        function openAuthModal() {
            const modal = document.getElementById('auth-modal');
            modal.style.display = 'flex';
            setTimeout(() => { modal.style.opacity = '1'; document.getElementById('auth-card-inner').style.transform = 'scale(1)'; }, 10);
        }
        function closeAuthModal() {
            const modal = document.getElementById('auth-modal');
            modal.style.opacity = '0';
            document.getElementById('auth-card-inner').style.transform = 'scale(0.9)';
            setTimeout(() => modal.style.display = 'none', 300);
        }
        function handleModalBgClick(e) {
            if (e.target === document.getElementById('auth-modal')) closeAuthModal();
        }
        function openAuth(mode) { openAuthModal(); toggleAuthMode(mode); }

        function toggleAuthMode(mode) {
            document.getElementById('login-form').style.display    = (mode === 'login')    ? 'block' : 'none';
            document.getElementById('register-form').style.display = (mode === 'register') ? 'block' : 'none';
            document.getElementById('forgot-form').style.display   = (mode === 'forgot')   ? 'block' : 'none';
            clearErrors();
        }
        function switchToForgot() { toggleAuthMode('forgot'); }
        function clearErrors() {
            ['login-error','reg-error','forgot-error','forgot-success'].forEach(id => {
                const el = document.getElementById(id); if(el) el.textContent='';
            });
        }

        // ============================================================
        // LOGIN TYPE TOGGLE (Email / Phone)
        // ============================================================
        function setLoginType(type) {
            loginType = type;
            const emailPill = document.getElementById('login-by-email-pill');
            const phonePill = document.getElementById('login-by-phone-pill');
            const input     = document.getElementById('login-identifier');
            if (type === 'email') {
                emailPill.classList.add('active');
                phonePill.classList.remove('active');
                input.type = 'email';
                input.placeholder = 'Email address';
            } else {
                phonePill.classList.add('active');
                emailPill.classList.remove('active');
                input.type = 'tel';
                input.placeholder = 'Phone number (e.g. +91XXXXXXXXXX)';
            }
            input.value = '';
        }

        // ============================================================
        // PASSWORD STRENGTH METER
        // ============================================================
        function checkPasswordStrength(password) {
            const ruleLen     = document.getElementById('rule-len');
            const ruleUpper   = document.getElementById('rule-upper');
            const ruleSpecial = document.getElementById('rule-special');
            const fill        = document.getElementById('pwd-meter-fill');
            const text        = document.getElementById('pwd-meter-text');

            const hasLen     = password.length >= 8;
            const hasUpper   = /[A-Z]/.test(password);
            const hasSpecial = /[^a-zA-Z0-9]/.test(password);

            ruleLen.classList.toggle('ok', hasLen);
            ruleUpper.classList.toggle('ok', hasUpper);
            ruleSpecial.classList.toggle('ok', hasSpecial);

            const score = [hasLen, hasUpper, hasSpecial].filter(Boolean).length;
            const configs = {
                0: { w: '0%',   bg: 'transparent', label: 'Enter a password' },
                1: { w: '33%',  bg: '#ff4444',      label: 'Weak' },
                2: { w: '66%',  bg: '#ffaa00',      label: 'Fair' },
                3: { w: '100%', bg: '#00ffcc',      label: 'Strong ‚úì' },
            };
            const cfg = configs[score];
            fill.style.width      = cfg.w;
            fill.style.background = cfg.bg;
            text.textContent      = cfg.label;
            text.style.color      = cfg.bg === 'transparent' ? 'rgba(255,255,255,0.4)' : cfg.bg;
        }

        // ============================================================
        // AUTH API CALLS
        // ============================================================
        function checkLoginStatus() {
            const token = localStorage.getItem('access_token');
            const name  = localStorage.getItem('user_name');
            if (token && name) {
                document.getElementById('login-btn').style.display  = 'none';
                document.getElementById('signup-btn').style.display = 'none';
                document.getElementById('user-greeting').innerText   = "HI, " + name;
                document.getElementById('user-greeting').style.display = 'block';
                document.getElementById('logout-btn').style.display    = 'flex';
                speak("Welcome back, " + name + "!");
                speak("Welcome back, " + name + "!");
            }
        }

        function registerUser() {
            const name     = document.getElementById('reg-name').value.trim();
            const email    = document.getElementById('reg-email').value.trim();
            const phone    = document.getElementById('reg-phone').value.trim();
            const password = document.getElementById('reg-password').value;
            const errEl    = document.getElementById('reg-error');
            const btn      = document.getElementById('reg-btn');

            errEl.textContent = '';

            if (!name || !email || !password) { errEl.textContent = 'Name, email and password are required.'; return; }

            const hasLen     = password.length >= 8;
            const hasUpper   = /[A-Z]/.test(password);
            const hasSpecial = /[^a-zA-Z0-9]/.test(password);
            if (!hasLen || !hasUpper || !hasSpecial) { 
            if (!hasLen || !hasUpper || !hasSpecial) { 
                errEl.textContent = 'Password does not meet all requirements above.'; return;
            }

            btn.disabled    = true;
            btn.textContent = 'Creating account‚Ä¶';

            fetch('/auth/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, email, phone, password })
            })
            .then(r => r.json())
            .then(data => {
                if (data.message) {
                    launchToast("Account created! Please log in.");
                    toggleAuthMode('login');
                    speak("Nice to meet you! Please log in.");
                    speak("Nice to meet you! Please log in.");
                } else {
                    errEl.textContent = data.detail || "Registration failed.";
                }
            })
            .catch(() => { errEl.textContent = "Network error. Please try again."; })
            .finally(() => { btn.disabled = false; btn.textContent = 'Create Account'; });
        }

        function loginUser() {
            const identifier = document.getElementById('login-identifier').value.trim();
            const password   = document.getElementById('login-password').value;
            const errEl      = document.getElementById('login-error');

            errEl.textContent = '';
            if (!identifier || !password) { errEl.textContent = 'Please enter your credentials.'; return; }

            fetch('/auth/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ identifier, password })
            })
            .then(r => r.json())
            .then(data => {
                if (data.access_token) {
                    localStorage.setItem('access_token', data.access_token);
                    localStorage.setItem('user_name', data.name);
                    closeAuthModal();
                    launchToast("Logged in successfully!");
                    checkLoginStatus();
                } else {
                    errEl.textContent = data.detail || "Login failed.";
                    speak("Hmm, those credentials don't look right.");
                    speak("Hmm, those credentials don't look right.");
                }
            })
            .catch(() => { errEl.textContent = "Network error. Please try again."; });
        }

        function sendForgotPassword() {
            const email   = document.getElementById('forgot-email').value.trim();
            const errEl   = document.getElementById('forgot-error');
            const succEl  = document.getElementById('forgot-success');
            const btn     = document.getElementById('forgot-btn');

            errEl.textContent  = '';
            succEl.textContent = '';
            if (!email) { errEl.textContent = 'Please enter your email address.'; return; }

            btn.disabled    = true;
            btn.textContent = 'Sending‚Ä¶';

            fetch('/auth/forgot_password', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email })
            })
            .then(r => r.json())
            .then(data => {
                if (data.message) {
                    succEl.textContent = data.message;
                    document.getElementById('forgot-email').value = '';
                    speak("I've sent a rescue link to your email!");
                    speak("I've sent a rescue link to your email!");
                } else {
                    errEl.textContent = data.detail || "Something went wrong.";
                }
            })
            .catch(() => { errEl.textContent = "Network error. Please try again."; })
            .finally(() => { btn.disabled = false; btn.textContent = 'Send Reset Link'; });
        }

        function logout() {
            localStorage.removeItem('access_token');
            localStorage.removeItem('user_name');
            location.reload();
        }

        // ============================================================
        // APP FUNCTIONALITY
        // APP FUNCTIONALITY
        // ============================================================
        function confirmPurge() {
            Swal.fire({
                title: 'Purge All History?',
                text: "This will permanently delete all recordings and transcripts!",
                icon: 'warning', showCancelButton: true,
                confirmButtonColor: '#ff8c00', cancelButtonColor: '#3085d6',
                confirmButtonText: 'Yes, Purge All',
                background: '#1a1a1a', color: '#fff', iconColor: '#ff8c00'
            }).then((result) => {
                if (result.isConfirmed) {
                    const form = document.createElement('form');
                    form.method = 'POST'; form.action = '/clear_all';
                    document.body.appendChild(form); form.submit();
                }
            });
        }

        function confirmDelete(filename, elementId) {
            Swal.fire({
                title: 'Delete File?', text: `You are about to delete ${filename}`,
                icon: 'warning', showCancelButton: true,
                confirmButtonColor: '#ff3c3c', cancelButtonColor: '#3085d6',
                confirmButtonText: 'Yes, delete it!',
                background: '#1a1a1a', color: '#fff', iconColor: '#ff3c3c'
            }).then((result) => {
                if (result.isConfirmed) {
                    fetch(`/delete/${filename}`, { method: 'POST' }).then(res => {
                        if (res.ok) {
                            const el = document.getElementById(elementId);
                            if (el) el.style.display = 'none';
                            launchToast("FILE DELETED", "delete");
                        }
                    });
                }
            });
        }

        function searchTerm() {
            const query = document.getElementById('transcript-search').value.toLowerCase();
            const box   = document.getElementById('dynamic-transcript-box');
            let text = currentDisplayTranscript.replace(/\[(\d{2}:\d{2}(?::\d{2})?\s*-\s*\d{2}:\d{2}(?::\d{2})?)\]/g, '<span class="timestamp">$1</span>');
            if (query.length > 1) {
                const regex = new RegExp(`(${query})`, 'gi');
                text = text.replace(regex, '<mark style="background:#ffff00;color:#000;border-radius:2px;padding:0 2px;">$1</mark>');
            }
            box.innerHTML = text;
        }

        function toggleAutoScroll() {
            isAutoScroll = !isAutoScroll;
            const btn = document.getElementById('autoscroll-btn');
            btn.innerText         = isAutoScroll ? "Auto-Scroll: ON" : "Auto-Scroll: OFF";
            btn.style.background  = isAutoScroll ? "#00ffff" : "rgba(255,255,255,0.1)";
            btn.style.color       = isAutoScroll ? "#000" : "#fff";
        }

        function handleAutoScroll() {
            if (isAutoScroll) {
                const box = document.getElementById('dynamic-transcript-box');
                box.scrollTop = box.scrollHeight;
            }
        }

        // --- NEW: JS SORTING FUNCTION ---
        function sortFiles() {
            const container = document.getElementById('file-list-root');
            const sortBy = document.getElementById('sort-filter').value;
            const items = Array.from(container.getElementsByClassName('file-item'));

            if(items.length < 2) return;

            items.sort((a, b) => {
                const timeA = parseFloat(a.getAttribute('data-timestamp'));
                const timeB = parseFloat(b.getAttribute('data-timestamp'));
                const sizeA = parseFloat(a.getAttribute('data-size'));
                const sizeB = parseFloat(b.getAttribute('data-size'));
                const typeA = a.getAttribute('data-type');
                const typeB = b.getAttribute('data-type');

                switch(sortBy) {
                    case 'newest':
                        return timeB - timeA;
                    case 'oldest':
                        return timeA - timeB;
                    case 'size-desc':
                        return sizeB - sizeA;
                    case 'size-asc':
                        return sizeA - sizeB;
                    case 'type':
                        return typeA.localeCompare(typeB);
                }
            });

            items.forEach(item => container.appendChild(item));
        }

        // --- NEW: JS SORTING FUNCTION ---
        function sortFiles() {
            const container = document.getElementById('file-list-root');
            const sortBy = document.getElementById('sort-filter').value;
            const items = Array.from(container.getElementsByClassName('file-item'));

            if(items.length < 2) return;

            items.sort((a, b) => {
                const timeA = parseFloat(a.getAttribute('data-timestamp'));
                const timeB = parseFloat(b.getAttribute('data-timestamp'));
                const sizeA = parseFloat(a.getAttribute('data-size'));
                const sizeB = parseFloat(b.getAttribute('data-size'));
                const typeA = a.getAttribute('data-type');
                const typeB = b.getAttribute('data-type');

                switch(sortBy) {
                    case 'newest':
                        return timeB - timeA;
                    case 'oldest':
                        return timeA - timeB;
                    case 'size-desc':
                        return sizeB - sizeA;
                    case 'size-asc':
                        return sizeA - sizeB;
                    case 'type':
                        return typeA.localeCompare(typeB);
                }
            });

            items.forEach(item => container.appendChild(item));
        }

        window.enterApp = function() {
            const landingView = document.getElementById('landing-view');
            const appView     = document.getElementById('app-view');
            landingView.style.opacity = '0';
            setTimeout(() => {
                landingView.style.display = 'none';
                appView.style.display     = 'flex';
                setTimeout(() => { appView.style.opacity = '1'; appView.style.transform = 'translateY(0)'; }, 50);
            }, 800);
        };

        window.onload = function() {
            if (typeof VANTA !== 'undefined') {
                VANTA.WAVES({ el: "#vanta-bg", mouseControls: true, color: 0x070707, waveHeight: 15 });
            }
            checkLoginStatus();

            const input       = document.getElementById('audio-input');
            const nameDisplay = document.getElementById('file-name-display');
            const audioPreview = document.getElementById('audio-live-preview');
            const submitBtn   = document.getElementById('submit-btn');
            
            // Bot Interaction: Drag Events
            const dropZone = document.querySelector('.drop-zone');
            dropZone.ondragover = () => speak("Ooh, a file! Feed me!", 0);
            dropZone.ondragleave = () => speak("Waiting for audio...", 3000);
            
            // Bot Interaction: Drag Events
            const dropZone = document.querySelector('.drop-zone');
            dropZone.ondragover = () => speak("Ooh, a file! Feed me!", 0);
            dropZone.ondragleave = () => speak("Waiting for audio...", 3000);

            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    nameDisplay.textContent = "‚úì " + file.name;
                    audioPreview.src = URL.createObjectURL(file);
                    document.getElementById('preview-container').style.display = "block";
                    document.getElementById('text-wrap').style.display = "none";
                    document.getElementById('icon').innerHTML = "‚úÖ";
                    speak("Looks like a good file! Click 'Transcribe Now'.");
                    speak("Looks like a good file! Click 'Transcribe Now'.");
                }
            };

            const uploadForm = document.getElementById('main-upload-form');
            uploadForm.onsubmit = function(e) {
                e.preventDefault();

                const token       = localStorage.getItem('access_token');
                const hasUsedFree = localStorage.getItem('free_trial_used');

                if (!token && hasUsedFree) {
                    speak("Free trial ended! Create an account to continue.");
                    speak("Free trial ended! Create an account to continue.");
                    Swal.fire({
                        title: 'Free Trial Ended',
                        text: 'You have used your free transcription. Please Sign Up or Login to continue!',
                        icon: 'info', confirmButtonText: 'Sign Up Now',
                        confirmButtonColor: '#00ffff', background: '#1a1a1a', color: '#fff'
                    }).then(() => { openAuth('register'); });
                    return;
                }

                submitBtn.disabled = true;
                submitBtn.innerText = "Uploading...";
                speak("Uploading to secure vault...");
                speak("Uploading to secure vault...");

                const formData = new FormData(uploadForm);
                const headers  = {};
                if (token) headers['Authorization'] = 'Bearer ' + token;

                fetch('/upload', { method: 'POST', body: formData, headers })
                .then(async res => {
                    const data = await res.json();
                    
                    // --- HANDLE FREE TRIAL REJECTION ---
                    if (res.status === 403 && data.error === 'FREE_TRIAL_ENDED') {
                        submitBtn.disabled = false;
                        submitBtn.innerText = "Transcribe Now";
                        speak("Access denied. Please sign up!");
                        
                        Swal.fire({
                            title: 'Free Trial Ended',
                            text: data.message,
                            icon: 'info',
                            confirmButtonText: 'Create Free Account',
                            confirmButtonColor: '#00ffff',
                            background: '#1a1a1a',
                            color: '#fff'
                        }).then(() => {
                            openAuth('register'); // Open Sign Up Modal
                        });
                        return; // Stop execution
                    }
                    // ----------------------------------------

                    if (res.ok && data.filename) {
                .then(async res => {
                    const data = await res.json();
                    
                    // --- HANDLE FREE TRIAL REJECTION ---
                    if (res.status === 403 && data.error === 'FREE_TRIAL_ENDED') {
                        submitBtn.disabled = false;
                        submitBtn.innerText = "Transcribe Now";
                        speak("Access denied. Please sign up!");
                        
                        Swal.fire({
                            title: 'Free Trial Ended',
                            text: data.message,
                            icon: 'info',
                            confirmButtonText: 'Create Free Account',
                            confirmButtonColor: '#00ffff',
                            background: '#1a1a1a',
                            color: '#fff'
                        }).then(() => {
                            openAuth('register'); // Open Sign Up Modal
                        });
                        return; // Stop execution
                    }
                    // ----------------------------------------

                    if (res.ok && data.filename) {
                        if (!token) localStorage.setItem('free_trial_used', 'true');
                        
                        
                        launchToast("UPLOAD SUCCESSFUL");
                        speak("File received! Processing now...");
                        speak("File received! Processing now...");
                        document.getElementById('progress-container').style.display = 'block';
                        currentFilename = data.filename;
                        pollStatus(data.filename);
                    } else {
                        Swal.fire({ 
                            icon: 'error', 
                            title: 'Upload Error', 
                            text: data.error || "Unknown Error", 
                            background: '#1a1a1a', 
                            color: '#fff' 
                        });
                        Swal.fire({ 
                            icon: 'error', 
                            title: 'Upload Error', 
                            text: data.error || "Unknown Error", 
                            background: '#1a1a1a', 
                            color: '#fff' 
                        });
                        submitBtn.disabled = false;
                        submitBtn.innerText = "Transcribe Now";
                        speak("Oops! Something went wrong with the upload.");
                        speak("Oops! Something went wrong with the upload.");
                    }
                })
                .catch(err => {
                    console.error(err);
                    submitBtn.disabled = false;
                    submitBtn.innerText = "Transcribe Now";
                    launchToast("Connection Failed", "delete");
                    speak("Having trouble? Check your internet connection.");
                    launchToast("Connection Failed", "delete");
                    speak("Having trouble? Check your internet connection.");
                });
            };
        };

        function pollStatus(filename) {
            const interval = setInterval(() => {
                fetch(`/check_status/${encodeURIComponent(filename)}`)
                .then(res => res.json())
                .then(data => {
                    const fill        = document.getElementById('progress-fill');
                    const percentText = document.getElementById('progress-percent');
                    const msgText     = document.getElementById('progress-message');

                    if (data.progress) { fill.style.width = data.progress + '%'; percentText.textContent = data.progress + '%'; }

                    if (data.status === 'processing') {
                        msgText.textContent = (data.progress > 65 && data.progress < 85)
                            ? "AI generating concise summary..."
                            : loadingMessages[Math.floor(Math.random() * loadingMessages.length)];
                    }

                    if (data.status === 'error') {
                        clearInterval(interval);
                        Swal.fire({ icon:'error', title:'Processing Failed', text: data.message });
                        document.getElementById('submit-btn').disabled = false;
                        document.getElementById('submit-btn').innerText = "Transcribe Now";
                        document.getElementById('progress-container').style.display = 'none';
                        speak("I failed to process that file. I'm sorry.");
                        speak("I failed to process that file. I'm sorry.");
                    }

                    if (data.status === 'completed') {
                        clearInterval(interval);
                        masterTranscript = data.transcript;
                        masterSummary    = data.summary;
                        document.getElementById('current-download-txt').href = `/download/${encodeURIComponent(filename)}?type=txt&lang=en`;
                        document.getElementById('current-download-pdf').href = `/download/${encodeURIComponent(filename)}?type=pdf&lang=en`;
                        displayResults(data.transcript, data.summary);
                        document.getElementById('progress-container').style.display = 'none';
                        document.getElementById('submit-btn').innerText = "Transcribe Now";
                        document.getElementById('submit-btn').disabled  = false;
                        speak("All done! Here is your report.");
                        speak("All done! Here is your report.");
                    }
                })
                .catch(err => console.error("Polling error:", err));
            }, 1500);
        }

        function translateReport() {
            const targetLang  = document.getElementById('report-lang-select').value;
            const translateBtn = document.getElementById('translate-btn');

            if (targetLang === 'en') {
                document.getElementById('current-download-txt').href = `/download/${encodeURIComponent(currentFilename)}?type=txt&lang=en`;
                document.getElementById('current-download-pdf').href = `/download/${encodeURIComponent(currentFilename)}?type=pdf&lang=en`;
                displayResults(masterTranscript, masterSummary);
                return;
            }

            translateBtn.innerText  = "Translating...";
            translateBtn.disabled   = true;
            speak("Translating to " + targetLang.toUpperCase() + "...");
            speak("Translating to " + targetLang.toUpperCase() + "...");

            fetch('/translate_on_fly', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ transcript: masterTranscript, summary: masterSummary, target: targetLang })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    displayResults(data.translated_text, data.translated_summary);
                    document.getElementById('current-download-txt').href = `/download/${encodeURIComponent(currentFilename)}?type=txt&lang=${targetLang}`;
                    document.getElementById('current-download-pdf').href = `/download/${encodeURIComponent(currentFilename)}?type=pdf&lang=${targetLang}`;
                    launchToast("Language Updated!");
                    speak("Translation complete!");
                    speak("Translation complete!");
                }
                translateBtn.innerText = "Update Language";
                translateBtn.disabled  = false;
            })
            .catch(() => { launchToast("Translation Error", "delete"); translateBtn.disabled = false; });
        }

        function displayResults(transcript, summary) {
            const resultPanel  = document.getElementById('dynamic-result-panel');
            const transcriptBox = document.getElementById('dynamic-transcript-box');
            const summaryBox   = document.getElementById('dynamic-summary-box');

            currentDisplayTranscript = transcript;
            document.getElementById('transcript-search').value = "";

            const highlighted = transcript.replace(/\[(\d{2}:\d{2}(?::\d{2})?\s*-\s*\d{2}:\d{2}(?::\d{2})?)\]/g, '<span class="timestamp">$1</span>');
            transcriptBox.innerHTML = highlighted;
            summaryBox.textContent  = summary || "No summary available (text might be too short)";

            resultPanel.style.display = 'block';
            if (!isAutoScroll) { resultPanel.scrollIntoView({ behavior: 'smooth' }); }
            else { handleAutoScroll(); }
        }

        function launchToast(message, type = "success") {
            const toast = document.getElementById('toast-message');
            toast.textContent    = message;
            toast.style.background = (type === "delete") ? "#ff3c3c" : "#00ffff";
            toast.style.opacity  = '1';
            setTimeout(() => { toast.style.opacity = '0'; }, 3000);
        }

        document.addEventListener('keydown', e => { if (e.key === 'Escape') closeAuthModal(); });
    </script>
>>>>>>> upstream/main
</body>

</html>